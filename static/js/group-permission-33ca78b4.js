import{A as x}from"./admin-9eccbf1c.js";import{_ as S,r as h,o as D,b as w,j as E,m as I,e as p,k as g,i as _,D as O,F as A,l as V,f as P,w as M}from"./index-2290b500.js";const B={props:["id","title"],setup(C,c){const v=h(!1),a=h({}),r=h([]),i=h([]),n=h([]),u=h([]),k=async()=>{if(a.value=await x.getAllPermissions(),C.id){const e=await x.getOneGroup(C.id);let t=[];const s={};e.permissions.forEach(l=>{i.value.push(l.id),u.value.push(l.name),t.push(l.module),s[l.module]?s[l.module]++:s[l.module]=1}),t=Array.from(new Set(t)),t.forEach(l=>{a.value[l].length!==s[l]&&r.value.push(l)}),n.value=Array.from(new Set(t))}c.emit("getCacheAuthIds",i.value.slice()),c.emit("updatePermissions",i.value),c.emit("updateAllPermissions",a.value)};return D(async()=>{try{v.value=!0,await k(),v.value=!1}catch(e){v.value=!1,console.error(e)}}),{loading:v,moduleCheck:(e,t,s)=>{const l=t.map(o=>o.id),m=t.map(o=>o.name);e?(i.value=Array.from(new Set(i.value.concat(l))),u.value=Array.from(new Set(u.value.concat(m))),n.value.includes(s)||n.value.push(s)):(i.value=i.value.filter(o=>!l.includes(o)),u.value=u.value.filter(o=>!m.includes(o)),n.value=n.value.filter(o=>o!==s)),r.value=r.value.filter(o=>o!==s),c.emit("updatePermissions",i.value)},singleCheck:(e,t,s)=>{const l=t.map(y=>y.id);let m=0;const o=i.value.indexOf(e);o===-1?i.value.push(e):i.value.splice(o,1),l.forEach(y=>{i.value.indexOf(y)>-1&&m++,l.length===m?(n.value.push(s),r.value=r.value.filter(d=>d!==s)):m===0?(n.value=n.value.filter(d=>d!==s),r.value=r.value.filter(d=>d!==s)):(n.value=n.value.filter(d=>d!==s),r.value.includes(s)||r.value.push(s))}),c.emit("updatePermissions",i.value)},allPermissions:a,halfPermissions:r,getGroupPermissions:k,permissionModuleIds:i,permissionModuleNames:n,checkedPermissionNames:u}}},G={class:"container"},F={class:"group"},U={class:"label"},j={class:"details"},L={class:"module-box"},q={class:"permissions-ul"};function z(C,c,v,a,r,i){const n=w("el-checkbox"),u=w("el-checkbox-group"),k=E("loading");return I((p(),g("div",G,[_("div",F,[_("div",U,[_("label",null,O(v.title),1)]),_("div",j,[(p(!0),g(A,null,V(a.allPermissions,(b,f)=>(p(),g("div",{class:"permissions-box",key:f},[P(u,{modelValue:a.permissionModuleNames,"onUpdate:modelValue":c[0]||(c[0]=e=>a.permissionModuleNames=e)},{default:M(()=>[_("div",L,[P(n,{onChange:e=>a.moduleCheck(e,b,f),class:"module",label:f,indeterminate:a.halfPermissions.includes(f)},null,8,["onChange","label","indeterminate"])])]),_:2},1032,["modelValue"]),P(u,{modelValue:a.checkedPermissionNames,"onUpdate:modelValue":c[1]||(c[1]=e=>a.checkedPermissionNames=e)},{default:M(()=>[_("ul",q,[(p(!0),g(A,null,V(b,(e,t)=>(p(),g("li",{class:"permissions-li",key:t},[P(n,{label:e.name,value:a.permissionModuleIds.indexOf(e.id)>-1,onChange:s=>a.singleCheck(e.id,b,f)},null,8,["label","value","onChange"])]))),128))])]),_:2},1032,["modelValue"])]))),128))])])])),[[k,a.loading]])}const K=S(B,[["render",z],["__scopeId","data-v-3b05c78b"]]);export{K as default};
