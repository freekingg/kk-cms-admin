import{m as c}from"./message-f78be324.js";import{g as R}from"./system-2a22b95c.js";import{A as i}from"./admin-c53e251c.js";import{_ as U}from"./form.vue_vue_type_script_setup_true_lang-976c4c27.js";import{r as l,x as A,o as D,Y as F,I as P}from"./index-f82ec64d.js";function _(){const n=l(),d=l([]),r=l(!0),o=l([]),f=[{label:"名称",prop:"name",minWidth:130},{label:"信息",prop:"info",minWidth:130},{label:"操作",fixed:"right",width:220,slot:"operation"}],m=A(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);async function p(e){await i.deleteOneUser(e.id),t()}async function t(){r.value=!0;const e=await i.getAllGroups({});d.value=e,setTimeout(()=>{r.value=!1},500)}const g=e=>{e&&(e.resetFields(),t())};function h(e){const v=e!=null&&e.id?"修改":"新增";F({title:`${v}用户`,props:{formInline:{username:(e==null?void 0:e.username)??"",email:(e==null?void 0:e.email)??"",groupIds:(e==null?void 0:e.groups.map(s=>s.id))??[]},allGroups:o,isEdited:!!(e!=null&&e.id)},width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>P(U,{ref:n}),beforeSure:(s,{options:b})=>{const I=n.value.getUserInfoRef(),x=n.value.getPwdRef(),y=n.value.activeTab,a=b.props.formInline;y===0?I.validate(u=>{u&&(e!=null&&e.id?(i.updateOneUser(a.email,a.groupIds,e.id).then(()=>{c("修改用户成功",{type:"success"}),t()}),s()):(UserModel.register(a).then(()=>{c("新增用户成功",{type:"success"}),t()}),s()))}):x.validate(u=>{u&&(i.changePassword(a.password,a.confirmPassword,e.id).then(()=>{c("修改密码成功",{type:"success"}),t()}),s())})}})}return D(()=>{t(),R().then(e=>{o.value=e})}),{loading:r,columns:f,dataList:d,buttonClass:m,onSearch:t,openDialog:h,resetForm:g,handleDelete:p}}export{_ as useUser};
