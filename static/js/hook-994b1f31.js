import{m as d}from"./message-ba84d1ea.js";import{g as R}from"./system-f8878388.js";import{r,x as U,o as A,Y as D,I as F,aR as P}from"./index-9b6c3733.js";import{A as l}from"./admin-752fdce6.js";import{_ as k}from"./form.vue_vue_type_script_setup_true_lang-218bd375.js";function G(){const n=r(),m=r([]),u=r(!0),o=r([]),f=[{label:"用户名称",prop:"username",minWidth:130},{label:"角色",minWidth:90,prop:"groups",formatter:({groups:e})=>{let i="";return e.map(s=>{i+=s.name+" "}),i}},{label:"操作",fixed:"right",width:180,slot:"operation"}],p=U(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);async function g(e){await l.deleteOneUser(e.id),t()}async function t(){u.value=!0;const e=await l.getAdminUsers({});m.value=e.items,setTimeout(()=>{u.value=!1},500)}const h=e=>{e&&(e.resetFields(),t())};function v(e){const i=e!=null&&e.id?"修改":"新增";D({title:`${i}用户`,props:{formInline:{username:(e==null?void 0:e.username)??"",email:(e==null?void 0:e.email)??"",groupIds:(e==null?void 0:e.groups.map(s=>s.id))??[]},allGroups:o,isEdited:!!(e!=null&&e.id)},width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>F(k,{ref:n}),beforeSure:(s,{options:b})=>{const I=n.value.getUserInfoRef(),x=n.value.getPwdRef(),y=n.value.activeTab,a=b.props.formInline;y===0?I.validate(c=>{c&&(e!=null&&e.id?(l.updateOneUser(a.email,a.groupIds,e.id).then(()=>{d("修改用户成功",{type:"success"}),t()}),s()):(P.register(a).then(()=>{d("新增用户成功",{type:"success"}),t()}),s()))}):x.validate(c=>{c&&(l.changePassword(a.password,a.confirmPassword,e.id).then(()=>{d("修改密码成功",{type:"success"}),t()}),s())})}})}return A(()=>{t(),R().then(e=>{o.value=e})}),{loading:u,columns:f,dataList:m,buttonClass:p,onSearch:t,openDialog:v,resetForm:h,handleDelete:g}}export{G as useUser};
