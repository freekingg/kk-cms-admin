import{useUser as Q}from"./hook-5595efeb.js";import{A as D}from"./admin-c53e251c.js";import{r as d,o as W,a7 as X,bn as Y,b3 as x,d as Z,b as v,e as C,k as G,i as A,f as o,w as l,h as e,g,c as ee,a9 as B,ao as oe,_ as le}from"./index-f82ec64d.js";import{P as te}from"./index-286a6153.js";import{u as ae}from"./hooks-b85cbf0e.js";import{A as ne}from"./add-circle-line-438b436c.js";import se from"./role-detail-e80e382c.js";import re from"./role-edit-ac22b8ba.js";import"./message-f78be324.js";import"./system-2a22b95c.js";import"./form.vue_vue_type_script_setup_true_lang-976c4c27.js";import"./epTheme-9c3b8b47.js";import"./sortable.esm-e674cde8.js";import"./group-permission-7503899e.js";const ie=E=>{const m=d([]),a=d(!1),c=async()=>{try{a.value=!0,m.value=await D.getAllGroups(),a.value=!1}catch(t){a.value=!1,console.error(t)}},r=t=>{let u={};Y.confirm("此操作将永久删除该分组, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{a.value=!0,u=await D.deleteOneGroup(t)}catch{a.value=!1}u.code?(E(),x.success(`${u.message}`)):(a.value=!1,x.error(`${u.message}`))})};return W(async()=>{await c()}),{loading:a,tableData:m,handleDelete:r,getAllGroups:c}},ue=(E,m)=>{let a={};const c=d(0),r=d(null),t=X({name:"",info:""}),u=d(!1),k={info:[],name:[{required:!0,message:"请输入分组名称",trigger:"blur"}]},V=i=>{c.value=i.id,t.name=i.name,t.info=i.info,a={...t},u.value=!0};return{id:c,form:r,rules:k,group:t,resetForm:()=>{r.value.resetFields()},handleEdit:V,confirmEdit:async()=>{if(t.name===""){x.warning("请将信息填写完整");return}if(a.name!==t.name||a.info!==t.info){const i=await D.updateOneGroup(t.name,t.info,c.value);x.success(`${i.message}`),m()}u.value=!1},handleClose:i=>{i()},rowDoubleClick:i=>{V(i)},dialogFormVisible:u}},de={class:"main"},ce={class:"w-full"},me={style:{"margin-top":"-25px"}},pe={class:"dialog-footer",style:{"padding-left":"5px"}},fe={key:0,style:{"margin-top":"-25px"}},_e={key:0,style:{"margin-top":"-25px"}},ve=Z({name:"User",__name:"index",setup(E){const{loading:m,columns:a,dataList:c,onSearch:r}=Q(),{getAllGroups:t,handleDelete:u}=ie(r),{form:k,rules:V,group:p,resetForm:R,handleEdit:U,confirmEdit:$,handleClose:i,dialogFormVisible:h}=ue(t,r),y=d(!1),b=d(!1),I=d(),O=d(),z=d(),P=async()=>{y.value=!0},q=async f=>{I.value.resetForm(),r(),f()},N=async()=>{r(),y.value=!1,b.value=!1},S=async f=>{r(),f()},j=async f=>{b.value=!0,z.value=f};return(f,n)=>{const _=v("el-button"),H=v("pure-table"),T=v("el-input"),M=v("el-form-item"),J=v("el-form"),F=v("el-dialog");return C(),G("div",de,[A("div",ce,[o(e(te),{title:"角色管理",columns:e(a),onRefresh:e(r)},{buttons:l(()=>[o(_,{type:"primary",icon:e(ae)(e(ne)),onClick:n[0]||(n[0]=s=>P())},{default:l(()=>[g(" 新增角色 ")]),_:1},8,["icon"])]),default:l(({size:s,dynamicColumns:K})=>[o(H,{border:"","align-whole":"center","table-layout":"auto",loading:e(m),size:s,data:e(c),columns:K,"header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"}},{operation:l(({row:w})=>[o(_,{plain:"",size:"small",type:"primary",onClick:L=>e(U)(w)},{default:l(()=>[g("信息")]),_:2},1032,["onClick"]),o(_,{plain:"",size:"small",type:"info",onClick:L=>j(w.id)},{default:l(()=>[g("权限")]),_:2},1032,["onClick"]),o(_,{plain:"",size:"small",type:"danger",onClick:L=>e(u)(w.id)},{default:l(()=>[g("删除")]),_:2},1032,["onClick"])]),_:2},1032,["loading","size","data","columns","header-cell-style"])]),_:1},8,["columns","onRefresh"])]),o(F,{title:"分组信息","append-to-body":!0,modelValue:e(h),"onUpdate:modelValue":n[3]||(n[3]=s=>oe(h)?h.value=s:null),"before-close":e(i)},{footer:l(()=>[A("div",pe,[o(_,{type:"primary",onClick:e($)},{default:l(()=>[g("确 定")]),_:1},8,["onClick"]),o(_,{onClick:e(R)},{default:l(()=>[g("重 置")]),_:1},8,["onClick"])])]),default:l(()=>[A("div",me,[e(h)?(C(),ee(J,{key:0,ref_key:"form",ref:k,"status-icon":"",rules:e(V),model:e(p),"label-width":"120px",style:{"margin-left":"-35px","margin-bottom":"-35px","margin-top":"15px"}},{default:l(()=>[o(M,{label:"分组名称",prop:"name"},{default:l(()=>[o(T,{clearable:"",modelValue:e(p).name,"onUpdate:modelValue":n[1]||(n[1]=s=>e(p).name=s)},null,8,["modelValue"])]),_:1}),o(M,{label:"分组描述",prop:"info"},{default:l(()=>[o(T,{clearable:"",modelValue:e(p).info,"onUpdate:modelValue":n[2]||(n[2]=s=>e(p).info=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])):B("",!0)])]),_:1},8,["modelValue","before-close"]),o(F,{title:"添加角色","append-to-body":!0,modelValue:y.value,"onUpdate:modelValue":n[4]||(n[4]=s=>y.value=s),"before-close":q},{default:l(()=>[y.value?(C(),G("div",fe,[o(se,{ref_key:"roleDetail",ref:I,onFinish:N},null,512)])):B("",!0)]),_:1},8,["modelValue"]),o(F,{title:"修改角色","append-to-body":!0,modelValue:b.value,"onUpdate:modelValue":n[5]||(n[5]=s=>b.value=s),"before-close":S},{default:l(()=>[b.value?(C(),G("div",_e,[o(re,{ref_key:"roleEdit",ref:O,groupId:z.value,onFinish:N},null,8,["groupId"])])):B("",!0)]),_:1},8,["modelValue"])])}}});const De=le(ve,[["__scopeId","data-v-0113bb3e"]]);export{De as default};
